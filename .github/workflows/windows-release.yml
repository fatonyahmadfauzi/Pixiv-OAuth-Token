name: Windows Release Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Build portable (no bump)
        shell: pwsh
        run: |
          cmd /c build_portable_pro.bat none

      - name: Install Inno Setup
        shell: pwsh
        run: |
          choco install innosetup -y

      - name: Generate .iss + Build installer
        shell: pwsh
        run: |
          python make_installer_iss.py
          & "${env:ProgramFiles(x86)}\Inno Setup 6\ISCC.exe" "pixiv_login_installer.iss"

      - name: Build ZIP release
        shell: pwsh
        run: |
          cmd /c build_release_zip.bat

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: windows-release
          path: |
            dist_portable\*
            dist_installer\*
            *.zip
